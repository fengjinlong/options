<template>
  <div class="valuation-container">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1 style="margin: 0; font-size: 24px; padding: 0">
        åŠ å¯†é¡¹ç›®ä¼°å€¼åˆ†æå·¥å…·
      </h1>
      <p class="subtitle">Crypto Project Valuation Tool</p>
    </div>

    <!-- æ¨¡å¼é€‰æ‹© -->
    <div class="mode-selection">
      <h2>ğŸ“Š åˆ†ææ¨¡å¼</h2>
      <div class="mode-options">
        <label class="mode-option">
          <input
            type="radio"
            v-model="analysisMode"
            value="single"
            class="mode-radio"
          />
          <span class="mode-label">å•é¡¹ç›®åˆ†æ</span>
        </label>
        <label class="mode-option">
          <input
            type="radio"
            v-model="analysisMode"
            value="dual"
            class="mode-radio"
          />
          <span class="mode-label">åŒé¡¹ç›®å¯¹æ¯”</span>
        </label>
      </div>
    </div>

    <!-- é¡¹ç›®è¾“å…¥åŒºåŸŸ -->
    <div class="input-section">
      <!-- é¡¹ç›®A -->
      <div class="project-input">
        <h3>é¡¹ç›®Aæ•°æ®</h3>
        <div class="project-name-input">
          <label>é¡¹ç›®åç§°</label>
          <input
            v-model="projectA.name"
            type="text"
            placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°ï¼Œå¦‚ï¼šUniswap"
            class="form-input project-name"
          />
        </div>
        <div class="metrics-grid">
          <div class="metric-item">
            <label>FDV (å®Œå…¨ç¨€é‡Šä¼°å€¼)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectA.fdv"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input type="radio" :value="1" v-model="projectA.fdvUnit" />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectA.fdvUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectA.fdvUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>MCap (å½“å‰å¸‚å€¼)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectA.mcap"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input type="radio" :value="1" v-model="projectA.mcapUnit" />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectA.mcapUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectA.mcapUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>TVL (æ€»é”ä»“ä»·å€¼)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectA.tvl"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input type="radio" :value="1" v-model="projectA.tvlUnit" />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectA.tvlUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectA.tvlUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>å¹´åŒ–æ”¶å…¥</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectA.revenue"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1"
                    v-model="projectA.revenueUnit"
                  />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectA.revenueUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectA.revenueUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>æ”¶å…¥å¢é•¿ç‡å­£åº¦ (%)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectA.growthRate"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <span class="unit-label">%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- é¡¹ç›®B (ä»…åŒé¡¹ç›®æ¨¡å¼æ˜¾ç¤º) -->
      <div class="project-input" v-if="analysisMode === 'dual'">
        <h3>é¡¹ç›®Bæ•°æ®</h3>
        <div class="project-name-input">
          <label>é¡¹ç›®åç§°</label>
          <input
            v-model="projectB.name"
            type="text"
            placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°ï¼Œå¦‚ï¼šSushiSwap"
            class="form-input project-name"
          />
        </div>
        <div class="metrics-grid">
          <div class="metric-item">
            <label>FDV (å®Œå…¨ç¨€é‡Šä¼°å€¼)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectB.fdv"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input type="radio" :value="1" v-model="projectB.fdvUnit" />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectB.fdvUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectB.fdvUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>MCap (å½“å‰å¸‚å€¼)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectB.mcap"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input type="radio" :value="1" v-model="projectB.mcapUnit" />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectB.mcapUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectB.mcapUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>TVL (æ€»é”ä»“ä»·å€¼)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectB.tvl"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input type="radio" :value="1" v-model="projectB.tvlUnit" />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectB.tvlUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectB.tvlUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>å¹´åŒ–æ”¶å…¥</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectB.revenue"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1"
                    v-model="projectB.revenueUnit"
                  />
                  <span>ä¸ª</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000"
                    v-model="projectB.revenueUnit"
                  />
                  <span>m</span>
                </label>
                <label class="radio-item">
                  <input
                    type="radio"
                    :value="1000000000"
                    v-model="projectB.revenueUnit"
                  />
                  <span>b</span>
                </label>
              </div>
            </div>
          </div>

          <div class="metric-item">
            <label>æ”¶å…¥å¢é•¿ç‡ (%)</label>
            <div class="input-with-unit">
              <input
                v-model.number="projectB.growthRate"
                type="number"
                placeholder="0"
                class="form-input"
              />
              <div class="unit-radio-group">
                <span class="unit-label">%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç”Ÿæˆåˆ†ææŒ‰é’® -->
    <div class="action-section">
      <button
        @click="generateAnalysis"
        class="analyze-btn"
        :disabled="isCalculating"
      >
        {{ isCalculating ? "åˆ†æä¸­..." : "ğŸ” ç”Ÿæˆè¯„ä¼°åˆ†æ" }}
      </button>
    </div>

    <!-- åˆ†æç»“æœå±•ç¤ºåŒº -->
    <div class="results-section" v-if="showResults">
      <!-- å•é¡¹ç›®ç»“æœ -->
      <div v-if="analysisMode === 'single'" class="single-analysis">
        <h3>ğŸ“ˆ {{ projectA.name || "é¡¹ç›®A" }} åˆ†æç»“æœ</h3>
        <div class="results-grid">
          <div
            class="result-item"
            v-for="(value, key) in analysisResult.ratios"
            :key="key"
          >
            <div class="metric-name">{{ getMetricName(key) }}</div>
            <div class="metric-value" :class="getValueClass(key, value)">
              {{ value.toFixed(2) }}
            </div>
            <div
              class="metric-assessment"
              :class="getAssessmentClass(analysisResult.assessments[key])"
            >
              {{ analysisResult.assessments[key] }}
            </div>
          </div>
        </div>

        <div class="text-analysis">
          <h4>ğŸ“ æ–‡å­—åˆ†æ</h4>
          <p>{{ analysisResult.textAnalysis }}</p>
        </div>

        <div class="conclusion">
          <h4>ğŸ¯ ç»¼åˆç»“è®º</h4>
          <div
            class="conclusion-content"
            :class="getConclusionClass(analysisResult.overallConclusion)"
          >
            {{ analysisResult.overallConclusion }}
          </div>
        </div>
      </div>

      <!-- åŒé¡¹ç›®å¯¹æ¯”ç»“æœ -->
      <div v-if="analysisMode === 'dual'" class="dual-analysis">
        <h3>ğŸ“Š å¯¹æ¯”åˆ†æç»“æœ</h3>

        <!-- CSS ç™¾åˆ†æ¯”æŸ±çŠ¶å›¾ -->
        <div class="comparison-charts">
          <div
            class="chart-item"
            v-for="(metric, key) in comparisonData"
            :key="key"
          >
            <div class="chart-title">{{ metric.name }}</div>
            <div class="chart-container">
              <!-- é¡¹ç›®A æŸ±çŠ¶å›¾ -->
              <div class="bar-wrapper">
                <div class="bar-label">{{ projectA.name || "é¡¹ç›®A" }}</div>
                <div class="bar-container">
                  <div
                    class="bar-fill bar-a"
                    :style="{ width: metric.percentageA + '%' }"
                  >
                    <span class="bar-value">{{
                      metric.valueA.toFixed(2)
                    }}</span>
                  </div>
                </div>
              </div>

              <!-- é¡¹ç›®B æŸ±çŠ¶å›¾ -->
              <div class="bar-wrapper">
                <div class="bar-label">{{ projectB.name || "é¡¹ç›®B" }}</div>
                <div class="bar-container">
                  <div
                    class="bar-fill bar-b"
                    :style="{ width: metric.percentageB + '%' }"
                  >
                    <span class="bar-value">{{
                      metric.valueB.toFixed(2)
                    }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- å¯¹æ¯”åˆ†ææ–‡å­— -->
        <div class="comparison-analysis">
          <h4>ğŸ“ å¯¹æ¯”åˆ†æ</h4>
          <p>{{ comparisonAnalysis }}</p>
        </div>

        <!-- ç»¼åˆç»“è®º -->
        <div class="comparison-conclusion">
          <h4>ğŸ¯ ç»¼åˆç»“è®º</h4>
          <div
            class="conclusion-content"
            :class="getConclusionClass(comparisonConclusion)"
          >
            {{ comparisonConclusion }}
          </div>
        </div>
      </div>
    </div>

    <!-- æŒ‡æ ‡è¯´æ˜åŒº -->
    <div class="metrics-explanation">
      <h3>ğŸ“š æŒ‡æ ‡è¯´æ˜</h3>
      <div class="explanation-grid">
        <div class="explanation-item">
          <h4>1. FDV/MCapï¼ˆå®Œå…¨ç¨€é‡Šä¼°å€¼ / æµé€šå¸‚å€¼ï¼‰</h4>
          <p>
            <strong>å«ä¹‰ï¼š</strong
            >åæ˜ æµé€šå¸‚å€¼ä¸å®Œå…¨ç¨€é‡Šä¼°å€¼çš„å…³ç³»ï¼Œè¡¡é‡æ½œåœ¨ç¨€é‡Šé£é™©ã€‚
          </p>
          <p>
            <strong>è¯„ä¼°åŒºé—´ï¼š</strong
            >1â€“1.5å¥åº·ï¼›1.5â€“3å¯æ¥å—ï¼›3â€“5è°¨æ…ï¼›5â€“10é«˜é£é™©ï¼›>10æé«˜é£é™©ã€‚
          </p>
        </div>

        <div class="explanation-item">
          <h4>2. MCap/TVLï¼ˆæµé€šå¸‚å€¼ / é”ä»“èµ„é‡‘é‡ï¼‰</h4>
          <p><strong>å«ä¹‰ï¼š</strong>è¡¡é‡å¸‚å€¼ä¸èµ„é‡‘æ²‰æ·€çš„åŒ¹é…åº¦ã€‚</p>
          <p>
            <strong>è¯„ä¼°åŒºé—´ï¼š</strong
            ><1å¯èƒ½ä½ä¼°ï¼›1â€“3åˆç†ï¼›3â€“5åé«˜ä¼°ï¼›5â€“10é«˜é£é™©ï¼›>10æç«¯é«˜ä¼°ã€‚
          </p>
        </div>

        <div class="explanation-item">
          <h4>3. MCap/å¹´åŒ–æ”¶å…¥</h4>
          <p>
            <strong>å«ä¹‰ï¼š</strong
            >æŠ•èµ„äººæ„¿æ„ä¸ºæ¯1ç¾å…ƒæ”¶å…¥æ”¯ä»˜å¤šå°‘å¸‚å€¼ï¼Œåæ˜ ä¼°å€¼æ°´å¹³ã€‚
          </p>
          <p>
            <strong>è¯„ä¼°åŒºé—´ï¼š</strong>DEX 10â€“30åˆç†ï¼›å…¬é“¾
            30â€“100åˆç†ï¼Œå¤§äº150é«˜ä¼°ï¼›ç¨³å®šå¸ 5â€“15åˆç†ï¼›CEX 5â€“20åˆç†ï¼›æ–°å…´èµ›é“
            40+é«˜é£é™©ã€‚
          </p>
        </div>

        <div class="explanation-item">
          <h4>4. FDV/TVLï¼ˆDeFiä¸“ç”¨ï¼‰</h4>
          <p><strong>å«ä¹‰ï¼š</strong>ä¼°å€¼ä¸ç®¡ç†èµ„äº§è§„æ¨¡çš„åŒ¹é…åº¦ã€‚</p>
          <p>
            <strong>è¯„ä¼°åŒºé—´ï¼š</strong
            ><0.5æ˜¾è‘—ä½ä¼°ï¼›0.5â€“1.5åˆç†ï¼›1.5â€“3åé«˜ï¼›>3é«˜ä¼°è­¦ç¤ºã€‚
          </p>
        </div>

        <div class="explanation-item">
          <h4>5. æ”¶å…¥å¢é•¿ç‡ï¼ˆå­£åº¦ç¯æ¯”ï¼‰</h4>
          <p><strong>å«ä¹‰ï¼š</strong>åæ˜ é¡¹ç›®çš„æˆé•¿æ€§ä¸ä¼°å€¼åˆç†æ€§ã€‚</p>
          <p>
            <strong>è¯„ä¼°åŒºé—´ï¼š</strong
            >>50%çˆ†å‘å¼å¢é•¿ï¼›10â€“50%å¥åº·å¢é•¿ï¼›<10%åœæ»/æˆç†Ÿã€‚
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from "vue";

// å“åº”å¼æ•°æ®
const analysisMode = ref("single");
const isCalculating = ref(false);
const showResults = ref(false);

// é¡¹ç›®æ•°æ®ç»“æ„
interface ProjectData {
  name: string;
  fdv: number;
  fdvUnit: number;
  mcap: number;
  mcapUnit: number;
  tvl: number;
  tvlUnit: number;
  revenue: number;
  revenueUnit: number;
  growthRate: number;
}

// åˆ†æç»“æœç»“æ„
interface AnalysisResult {
  ratios: {
    fdvMcap: number;
    mcapTvl: number;
    mcapRevenue: number;
    fdvTvl: number;
    growthRate: number;
  };
  assessments: {
    fdvMcap: string;
    mcapTvl: string;
    mcapRevenue: string;
    fdvTvl: string;
    growthRate: string;
  };
  overallConclusion: string;
  textAnalysis: string;
}

// åˆå§‹åŒ–é¡¹ç›®æ•°æ®
const projectA = ref<ProjectData>({
  name: "",
  fdv: 0,
  fdvUnit: 1000000,
  mcap: 0,
  mcapUnit: 1000000,
  tvl: 0,
  tvlUnit: 1000000,
  revenue: 0,
  revenueUnit: 1000000,
  growthRate: 0,
});

const projectB = ref<ProjectData>({
  name: "",
  fdv: 0,
  fdvUnit: 1000000,
  mcap: 0,
  mcapUnit: 1000000,
  tvl: 0,
  tvlUnit: 1000000,
  revenue: 0,
  revenueUnit: 1000000,
  growthRate: 0,
});

// åˆ†æç»“æœ
const analysisResult = ref<AnalysisResult>({
  ratios: {
    fdvMcap: 0,
    mcapTvl: 0,
    mcapRevenue: 0,
    fdvTvl: 0,
    growthRate: 0,
  },
  assessments: {
    fdvMcap: "",
    mcapTvl: "",
    mcapRevenue: "",
    fdvTvl: "",
    growthRate: "",
  },
  overallConclusion: "",
  textAnalysis: "",
});

// å¯¹æ¯”æ•°æ®
const comparisonAnalysis = ref("");
const comparisonConclusion = ref("");

// è®¡ç®—ä¼°å€¼æ¯”ç‡
const calculateRatios = (project: ProjectData) => {
  const fdv = project.fdv * project.fdvUnit;
  const mcap = project.mcap * project.mcapUnit;
  const tvl = project.tvl * project.tvlUnit;
  const revenue = project.revenue * project.revenueUnit;
  const growthRate = project.growthRate;

  return {
    fdvMcap: mcap > 0 ? fdv / mcap : 0,
    mcapTvl: tvl > 0 ? mcap / tvl : 0,
    mcapRevenue: revenue > 0 ? mcap / revenue : 0,
    fdvTvl: tvl > 0 ? fdv / tvl : 0,
    growthRate: growthRate,
  };
};

// è¯„ä¼°æŒ‡æ ‡çŠ¶æ€
const assessMetric = (key: string, value: number) => {
  const thresholds = {
    fdvMcap: { low: 1, medium: 1.5, high: 3, veryHigh: 5 },
    mcapTvl: { low: 1, medium: 3, high: 5, veryHigh: 10 },
    mcapRevenue: { low: 10, medium: 30, high: 100, veryHigh: 150 },
    fdvTvl: { low: 0.5, medium: 1.5, high: 3, veryHigh: 5 },
    growthRate: { low: 10, medium: 50, high: 100, veryHigh: 200 },
  };

  const threshold = thresholds[key as keyof typeof thresholds];
  if (!threshold) return "æœªçŸ¥";

  if (value < threshold.low) return "å¯èƒ½ä½ä¼°";
  if (value < threshold.medium) return "åˆç†";
  if (value < threshold.high) return "åé«˜";
  if (value < threshold.veryHigh) return "é«˜ä¼°è­¦ç¤º";
  return "æé«˜é£é™©";
};

// ç”Ÿæˆæ–‡å­—åˆ†æ
const generateTextAnalysis = (ratios: any, assessments: any) => {
  let analysis = "";

  // FDV/MCapåˆ†æ
  if (ratios.fdvMcap > 0) {
    if (assessments.fdvMcap === "å¥åº·") {
      analysis += `FDV/MCapæ¯”ç‡ä¸º${ratios.fdvMcap.toFixed(
        2
      )}ï¼Œå¤„äºå¥åº·åŒºé—´ï¼Œç¨€é‡Šé£é™©è¾ƒä½ã€‚`;
    } else if (assessments.fdvMcap === "åˆç†") {
      analysis += `FDV/MCapæ¯”ç‡ä¸º${ratios.fdvMcap.toFixed(
        2
      )}ï¼Œå¤„äºåˆç†åŒºé—´ï¼Œå­˜åœ¨ä¸€å®šç¨€é‡Šé£é™©ã€‚`;
    } else {
      analysis += `FDV/MCapæ¯”ç‡ä¸º${ratios.fdvMcap.toFixed(2)}ï¼Œ${
        assessments.fdvMcap
      }ï¼Œéœ€è¦å…³æ³¨ç¨€é‡Šé£é™©ã€‚`;
    }
  }

  // MCap/TVLåˆ†æ
  if (ratios.mcapTvl > 0) {
    analysis += ` MCap/TVLæ¯”ç‡ä¸º${ratios.mcapTvl.toFixed(2)}ï¼Œ${
      assessments.mcapTvl
    }ã€‚`;
  }

  // MCap/æ”¶å…¥åˆ†æ
  if (ratios.mcapRevenue > 0) {
    analysis += ` MCap/å¹´åŒ–æ”¶å…¥æ¯”ç‡ä¸º${ratios.mcapRevenue.toFixed(2)}ï¼Œ${
      assessments.mcapRevenue
    }ã€‚`;
  }

  // æ”¶å…¥å¢é•¿ç‡åˆ†æ
  if (ratios.growthRate > 0) {
    analysis += ` æ”¶å…¥å¢é•¿ç‡ä¸º${ratios.growthRate.toFixed(1)}%ï¼Œ${
      assessments.growthRate
    }ã€‚`;
  }

  return analysis;
};

// ç”Ÿæˆç»¼åˆç»“è®º
const generateOverallConclusion = (assessments: any) => {
  const riskCount = Object.values(assessments).filter(
    (assessment) =>
      assessment === "æé«˜é£é™©" ||
      assessment === "é«˜ä¼°è­¦ç¤º" ||
      assessment === "åé«˜"
  ).length;

  const healthyCount = Object.values(assessments).filter(
    (assessment) => assessment === "åˆç†" || assessment === "å¯èƒ½ä½ä¼°"
  ).length;

  if (riskCount >= 3) {
    return "ä¼°å€¼åé«˜ï¼Œå­˜åœ¨è¾ƒé«˜é£é™©ï¼Œå»ºè®®è°¨æ…æŠ•èµ„";
  } else if (healthyCount >= 3) {
    return "ä¼°å€¼ç›¸å¯¹åˆç†ï¼Œå…·å¤‡ä¸€å®šæŠ•èµ„ä»·å€¼";
  } else {
    return "ä¼°å€¼æ°´å¹³ä¸­ç­‰ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æé¡¹ç›®åŸºæœ¬é¢";
  }
};

// è®¡ç®—å¯¹æ¯”æ•°æ®
const comparisonData = computed(() => {
  if (analysisMode.value !== "dual") return [];

  const ratiosA = calculateRatios(projectA.value);
  const ratiosB = calculateRatios(projectB.value);

  const metrics = [
    { key: "fdvMcap", name: "FDV/MCap" },
    { key: "mcapTvl", name: "MCap/TVL" },
    { key: "mcapRevenue", name: "MCap/å¹´åŒ–æ”¶å…¥" },
    { key: "fdvTvl", name: "FDV/TVL" },
    { key: "growthRate", name: "æ”¶å…¥å¢é•¿ç‡" },
  ];

  return metrics.map((metric) => {
    const valueA = ratiosA[metric.key as keyof typeof ratiosA];
    const valueB = ratiosB[metric.key as keyof typeof ratiosB];

    // è®¡ç®—ç™¾åˆ†æ¯”ï¼ˆåŸºäºè¾ƒå¤§å€¼ï¼‰
    const maxValue = Math.max(valueA, valueB);
    const percentageA = maxValue > 0 ? (valueA / maxValue) * 100 : 0;
    const percentageB = maxValue > 0 ? (valueB / maxValue) * 100 : 0;

    return {
      name: metric.name,
      valueA,
      valueB,
      percentageA,
      percentageB,
    };
  });
});

// ç”Ÿæˆåˆ†æ
const generateAnalysis = async () => {
  isCalculating.value = true;
  showResults.value = false;

  // æ¨¡æ‹Ÿè®¡ç®—å»¶è¿Ÿ
  await new Promise((resolve) => setTimeout(resolve, 1000));

  if (analysisMode.value === "single") {
    // å•é¡¹ç›®åˆ†æ
    const ratios = calculateRatios(projectA.value);
    const assessments = {
      fdvMcap: assessMetric("fdvMcap", ratios.fdvMcap),
      mcapTvl: assessMetric("mcapTvl", ratios.mcapTvl),
      mcapRevenue: assessMetric("mcapRevenue", ratios.mcapRevenue),
      fdvTvl: assessMetric("fdvTvl", ratios.fdvTvl),
      growthRate: assessMetric("growthRate", ratios.growthRate),
    };

    analysisResult.value = {
      ratios,
      assessments,
      overallConclusion: generateOverallConclusion(assessments),
      textAnalysis: generateTextAnalysis(ratios, assessments),
    };
  } else {
    // åŒé¡¹ç›®å¯¹æ¯”åˆ†æ
    const ratiosA = calculateRatios(projectA.value);
    const ratiosB = calculateRatios(projectB.value);

    // ç”Ÿæˆå¯¹æ¯”åˆ†æ
    comparisonAnalysis.value = generateComparisonAnalysis(ratiosA, ratiosB);
    comparisonConclusion.value = generateComparisonConclusion(ratiosA, ratiosB);
  }

  isCalculating.value = false;
  showResults.value = true;
};

// ç”Ÿæˆå¯¹æ¯”åˆ†æ
const generateComparisonAnalysis = (ratiosA: any, ratiosB: any) => {
  const projectAName = projectA.value.name || "é¡¹ç›®A";
  const projectBName = projectB.value.name || "é¡¹ç›®B";

  let analysis = "é€šè¿‡å¯¹æ¯”åˆ†æå‘ç°ï¼š";

  // æ¯”è¾ƒå„ä¸ªæŒ‡æ ‡
  if (ratiosA.fdvMcap < ratiosB.fdvMcap) {
    analysis += ` ${projectAName}åœ¨ç¨€é‡Šé£é™©æ§åˆ¶ä¸Šæ›´ä¼˜ï¼›`;
  } else {
    analysis += ` ${projectBName}åœ¨ç¨€é‡Šé£é™©æ§åˆ¶ä¸Šæ›´ä¼˜ï¼›`;
  }

  if (ratiosA.mcapTvl < ratiosB.mcapTvl) {
    analysis += ` ${projectAName}çš„å¸‚å€¼ä¸TVLåŒ¹é…åº¦æ›´å¥½ï¼›`;
  } else {
    analysis += ` ${projectBName}çš„å¸‚å€¼ä¸TVLåŒ¹é…åº¦æ›´å¥½ï¼›`;
  }

  if (ratiosA.mcapRevenue < ratiosB.mcapRevenue) {
    analysis += ` ${projectAName}çš„å¸‚å€¼ä¸æ”¶å…¥åŒ¹é…åº¦æ›´å¥½ï¼›`;
  } else {
    analysis += ` ${projectBName}çš„å¸‚å€¼ä¸æ”¶å…¥åŒ¹é…åº¦æ›´å¥½ï¼›`;
  }

  if (ratiosA.growthRate > ratiosB.growthRate) {
    analysis += ` ${projectAName}çš„æ”¶å…¥å¢é•¿ç‡æ›´é«˜ï¼Œæˆé•¿æ€§æ›´å¼ºã€‚`;
  } else {
    analysis += ` ${projectBName}çš„æ”¶å…¥å¢é•¿ç‡æ›´é«˜ï¼Œæˆé•¿æ€§æ›´å¼ºã€‚`;
  }

  return analysis;
};

// ç”Ÿæˆå¯¹æ¯”ç»“è®º
const generateComparisonConclusion = (ratiosA: any, ratiosB: any) => {
  const projectAName = projectA.value.name || "é¡¹ç›®A";
  const projectBName = projectB.value.name || "é¡¹ç›®B";

  let scoreA = 0;
  let scoreB = 0;

  // è¯„åˆ†é€»è¾‘ï¼ˆæ•°å€¼è¶Šå°è¶Šå¥½ï¼Œé™¤äº†å¢é•¿ç‡ï¼‰
  const metrics = ["fdvMcap", "mcapTvl", "mcapRevenue", "fdvTvl"];

  metrics.forEach((metric) => {
    if (ratiosA[metric] < ratiosB[metric]) scoreA++;
    else scoreB++;
  });

  // å¢é•¿ç‡è¯„åˆ†ï¼ˆæ•°å€¼è¶Šå¤§è¶Šå¥½ï¼‰
  if (ratiosA.growthRate > ratiosB.growthRate) scoreA++;
  else scoreB++;

  if (scoreA > scoreB) {
    return `${projectAName}æ•´ä½“ä¼°å€¼æ›´åˆç†ï¼ŒæŠ•èµ„ä»·å€¼æ›´é«˜`;
  } else if (scoreB > scoreA) {
    return `${projectBName}æ•´ä½“ä¼°å€¼æ›´åˆç†ï¼ŒæŠ•èµ„ä»·å€¼æ›´é«˜`;
  } else {
    return "ä¸¤ä¸ªé¡¹ç›®ä¼°å€¼æ°´å¹³ç›¸å½“ï¼Œéœ€è¦ç»“åˆå…¶ä»–å› ç´ ç»¼åˆåˆ¤æ–­";
  }
};

// è·å–æŒ‡æ ‡åç§°
const getMetricName = (key: string) => {
  const names: { [key: string]: string } = {
    fdvMcap: "FDV/MCap",
    mcapTvl: "MCap/TVL",
    mcapRevenue: "MCap/å¹´åŒ–æ”¶å…¥",
    fdvTvl: "FDV/TVL",
    growthRate: "æ”¶å…¥å¢é•¿ç‡",
  };
  return names[key] || key;
};

// è·å–æ•°å€¼æ ·å¼ç±»
const getValueClass = (key: string, value: number) => {
  const assessment = assessMetric(key, value);
  if (assessment === "åˆç†" || assessment === "å¯èƒ½ä½ä¼°")
    return "value-healthy";
  if (
    assessment === "åé«˜" ||
    assessment === "é«˜ä¼°è­¦ç¤º" ||
    assessment === "æé«˜é£é™©"
  )
    return "value-risky";
  return "value-neutral";
};

// è·å–è¯„ä¼°æ ·å¼ç±»
const getAssessmentClass = (assessment: string) => {
  if (assessment === "åˆç†" || assessment === "å¯èƒ½ä½ä¼°")
    return "assessment-healthy";
  if (
    assessment === "åé«˜" ||
    assessment === "é«˜ä¼°è­¦ç¤º" ||
    assessment === "æé«˜é£é™©"
  )
    return "assessment-risky";
  return "assessment-neutral";
};

// è·å–ç»“è®ºæ ·å¼ç±»
const getConclusionClass = (conclusion: string) => {
  if (conclusion.includes("åˆç†") || conclusion.includes("ä»·å€¼"))
    return "conclusion-positive";
  if (conclusion.includes("é£é™©") || conclusion.includes("è°¨æ…"))
    return "conclusion-warning";
  return "conclusion-neutral";
};

// ç›‘å¬æ¨¡å¼å˜åŒ–
watch(analysisMode, () => {
  showResults.value = false;
});
</script>

<style scoped>
.valuation-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

.page-header {
  text-align: center;
  margin-bottom: 30px;
}

.page-header h1 {
  font-size: 28px;
  font-weight: bold;
  color: #2c3e50;
  margin: 0 0 10px 0;
}

.subtitle {
  color: #7f8c8d;
  font-size: 16px;
  margin: 0;
}

.mode-selection {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 30px;
}

.mode-selection h2 {
  margin: 0 0 15px 0;
  color: #2c3e50;
}

.mode-options {
  display: flex;
  gap: 20px;
}

.mode-option {
  display: flex;
  align-items: center;
  cursor: pointer;
}

.mode-radio {
  margin-right: 8px;
}

.mode-label {
  font-weight: 500;
  color: #2c3e50;
}

.input-section {
  margin-bottom: 30px;
}

.project-input {
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.project-input h3 {
  margin: 0 0 20px 0;
  color: #2c3e50;
  font-size: 18px;
}

.project-name-input {
  margin-bottom: 20px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid #007bff;
}

.project-name-input label {
  display: block;
  font-weight: 500;
  color: #2c3e50;
  margin-bottom: 8px;
}

.project-name {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.metric-item {
  display: flex;
  flex-direction: column;
}

.metric-item label {
  font-weight: 500;
  color: #2c3e50;
  margin-bottom: 8px;
}

.input-with-unit {
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-input {
  flex: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.unit-radio-group {
  display: flex;
  gap: 8px;
}

.radio-item {
  display: flex;
  align-items: center;
  cursor: pointer;
}

.radio-item input {
  margin-right: 4px;
}

.unit-label {
  color: #7f8c8d;
  font-size: 14px;
}

.action-section {
  text-align: center;
  margin: 30px 0;
}

.analyze-btn {
  background: #007bff;
  color: white;
  border: none;
  padding: 12px 30px;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.3s;
}

.analyze-btn:hover:not(:disabled) {
  background: #0056b3;
}

.analyze-btn:disabled {
  background: #6c757d;
  cursor: not-allowed;
}

.results-section {
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 30px;
}

.results-section h3 {
  margin: 0 0 20px 0;
  color: #2c3e50;
}

.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.result-item {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 6px;
  text-align: center;
}

.metric-name {
  font-weight: 500;
  color: #2c3e50;
  margin-bottom: 8px;
}

.metric-value {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 5px;
}

.value-healthy {
  color: #28a745;
}

.value-risky {
  color: #dc3545;
}

.value-neutral {
  color: #6c757d;
}

.metric-assessment {
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 4px;
  display: inline-block;
}

.assessment-healthy {
  background: #d4edda;
  color: #155724;
}

.assessment-risky {
  background: #f8d7da;
  color: #721c24;
}

.assessment-neutral {
  background: #d1ecf1;
  color: #0c5460;
}

.text-analysis,
.conclusion {
  margin-top: 20px;
}

.text-analysis h4,
.conclusion h4 {
  margin: 0 0 10px 0;
  color: #2c3e50;
}

.conclusion-content {
  padding: 15px;
  border-radius: 6px;
  font-weight: 500;
}

.conclusion-positive {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.conclusion-warning {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.conclusion-neutral {
  background: #d1ecf1;
  color: #0c5460;
  border: 1px solid #bee5eb;
}

/* CSS ç™¾åˆ†æ¯”æŸ±çŠ¶å›¾æ ·å¼ */
.comparison-charts {
  display: grid;
  gap: 25px;
  margin: 20px 0;
}

.chart-item {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  border: 1px solid #e9ecef;
}

.chart-title {
  font-size: 16px;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 15px;
  text-align: center;
}

.chart-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.bar-wrapper {
  display: flex;
  align-items: center;
  gap: 15px;
}

.bar-label {
  min-width: 80px;
  font-weight: 500;
  color: #2c3e50;
  font-size: 14px;
}

.bar-container {
  flex: 1;
  height: 30px;
  background: #e9ecef;
  border-radius: 15px;
  position: relative;
  overflow: hidden;
}

.bar-fill {
  height: 100%;
  border-radius: 15px;
  position: relative;
  transition: width 0.8s ease-in-out;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 10px;
}

.bar-a {
  background: linear-gradient(90deg, #5470c6, #3b4f8a);
}

.bar-b {
  background: linear-gradient(90deg, #91cc75, #6ba85a);
}

.bar-value {
  color: white;
  font-weight: 600;
  font-size: 12px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.comparison-analysis,
.comparison-conclusion {
  margin-top: 20px;
}

.comparison-analysis h4,
.comparison-conclusion h4 {
  margin: 0 0 10px 0;
  color: #2c3e50;
}

.metrics-explanation {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
}

.metrics-explanation h3 {
  margin: 0 0 20px 0;
  color: #2c3e50;
}

.explanation-grid {
  display: grid;
  gap: 20px;
}

.explanation-item {
  background: white;
  padding: 15px;
  border-radius: 6px;
  border-left: 4px solid #007bff;
}

.explanation-item h4 {
  margin: 0 0 10px 0;
  color: #2c3e50;
  font-size: 16px;
}

.explanation-item p {
  margin: 5px 0;
  color: #6c757d;
  line-height: 1.5;
}

@media (max-width: 768px) {
  .metrics-grid {
    grid-template-columns: 1fr;
  }

  .mode-options {
    flex-direction: column;
    gap: 10px;
  }

  .results-grid {
    grid-template-columns: 1fr;
  }

  .bar-wrapper {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }

  .bar-label {
    min-width: auto;
    text-align: center;
  }

  .bar-container {
    height: 25px;
  }

  .bar-value {
    font-size: 11px;
  }
}
</style>
